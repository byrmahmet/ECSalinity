<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .cm {
  color: #999988;
  font-style: italic;
}
.highlight .cp {
  color: #999999;
  font-weight: bold;
}
.highlight .c1 {
  color: #999988;
  font-style: italic;
}
.highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
.highlight .c, .highlight .cd {
  color: #999988;
  font-style: italic;
}
.highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}
.highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}
.highlight .ge {
  color: #000000;
  font-style: italic;
}
.highlight .gr {
  color: #aa0000;
}
.highlight .gh {
  color: #999999;
}
.highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .gt {
  color: #aa0000;
}
.highlight .kc {
  color: #000000;
  font-weight: bold;
}
.highlight .kd {
  color: #000000;
  font-weight: bold;
}
.highlight .kn {
  color: #000000;
  font-weight: bold;
}
.highlight .kp {
  color: #000000;
  font-weight: bold;
}
.highlight .kr {
  color: #000000;
  font-weight: bold;
}
.highlight .kt {
  color: #445588;
  font-weight: bold;
}
.highlight .k, .highlight .kv {
  color: #000000;
  font-weight: bold;
}
.highlight .mf {
  color: #009999;
}
.highlight .mh {
  color: #009999;
}
.highlight .il {
  color: #009999;
}
.highlight .mi {
  color: #009999;
}
.highlight .mo {
  color: #009999;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #009999;
}
.highlight .sb {
  color: #d14;
}
.highlight .sc {
  color: #d14;
}
.highlight .sd {
  color: #d14;
}
.highlight .s2 {
  color: #d14;
}
.highlight .se {
  color: #d14;
}
.highlight .sh {
  color: #d14;
}
.highlight .si {
  color: #d14;
}
.highlight .sx {
  color: #d14;
}
.highlight .sr {
  color: #009926;
}
.highlight .s1 {
  color: #d14;
}
.highlight .ss {
  color: #990073;
}
.highlight .s {
  color: #d14;
}
.highlight .na {
  color: #008080;
}
.highlight .bp {
  color: #999999;
}
.highlight .nb {
  color: #0086B3;
}
.highlight .nc {
  color: #445588;
  font-weight: bold;
}
.highlight .no {
  color: #008080;
}
.highlight .nd {
  color: #3c5d5d;
  font-weight: bold;
}
.highlight .ni {
  color: #800080;
}
.highlight .ne {
  color: #990000;
  font-weight: bold;
}
.highlight .nf {
  color: #990000;
  font-weight: bold;
}
.highlight .nl {
  color: #990000;
  font-weight: bold;
}
.highlight .nn {
  color: #555555;
}
.highlight .nt {
  color: #000080;
}
.highlight .vc {
  color: #008080;
}
.highlight .vg {
  color: #008080;
}
.highlight .vi {
  color: #008080;
}
.highlight .nv {
  color: #008080;
}
.highlight .ow {
  color: #000000;
  font-weight: bold;
}
.highlight .o {
  color: #000000;
  font-weight: bold;
}
.highlight .w {
  color: #bbbbbb;
}
.highlight {
  background-color: #f8f8f8;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;cpp&quot;,&quot;python&quot;,&quot;shell&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="cpp">cpp</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="shell">shell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li>for firmware version 1a</li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Measure Electrical Conductivity in Siemens, Total Dissolved Solids in PPM, Salinity in PSU and PPT.</p>

<p>Monitor hydroponic nutrient levels, salinity levels in aquariums or the ocean, saltwater pools, soil salinity, water quality etc.</p>

<p>It uses the standard Arduino Wire library to interface with the device.
It&rsquo;s operating principle is based on sending a very short-duration DC pulse
from one probe pin and measuring the conductivity on the other pin. The conductivity
is then converted to a temperature compensated Siemen. Salinity is also derived
from the measure and is in PSU, PPT, and PPM.</p>

<h2 id="characteristics">Characteristics</h2>

<ul>
<li><strong>EC range</strong>: ~0.06 - ~200mS depending on probe</li>
<li><strong>Salinity range</strong>: 2 - 42</li>
<li><strong>Temperature range</strong>: -2 - 35C</li>
<li><strong>Interface</strong>: I2C</li>
<li><strong>Current use</strong>: ~10mA peak, low idle current ~1mA</li>
<li><strong>Voltage range</strong>: 2.7 - 5.5V</li>
</ul>

<h1 id="connections">Connections</h1>

<h2 id="i2c-connections">I2C Connections</h2>

<p>The connection to the device is as follows:</p>

<table><thead>
<tr>
<th style="text-align: center">EC Salinity Probe</th>
<th style="text-align: center">Master device</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">GND</td>
<td style="text-align: center">GND</td>
</tr>
<tr>
<td style="text-align: center">SCL</td>
<td style="text-align: center">SCL</td>
</tr>
<tr>
<td style="text-align: center">SDA</td>
<td style="text-align: center">SDA</td>
</tr>
<tr>
<td style="text-align: center">VCC</td>
<td style="text-align: center">2.7 - 5V</td>
</tr>
</tbody></table>

<h2 id="temperature-probe-connections">Temperature Probe Connections</h2>

<p>The temperature probe comes with a 3-wire header. The VCC pin is labeled with a triangle:</p>

<table><thead>
<tr>
<th style="text-align: center">EC Salinity Probe</th>
<th style="text-align: center">Temperature Probe</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">+</td>
<td style="text-align: center">(triangle</td>
</tr>
<tr>
<td style="text-align: center">D</td>
<td style="text-align: center"></td>
</tr>
<tr>
<td style="text-align: center">-</td>
<td style="text-align: center"></td>
</tr>
</tbody></table>

<h2 id="ec-probe-connections">EC Probe Connections</h2>

<p>The EC probe has two pins and can be connected either way.</p>

<h3 id="probe-selection">Probe Selection</h3>

<p>Any 2-electrode probe can be attached to the device.</p>

<p>A probe with a K constant of:</p>

<ul>
<li>0.1K can measure from 0.06 - 199.9 uS</li>
<li>1K from 0 - 1999 uS</li>
<li>10K from 0 - 200 mS</li>
</ul>

<h1 id="getting-started">Getting Started</h1>

<p>To start developing for the device, you need to install the library. Two are provided, one for the Arduino framework, and the other for python3 on the Raspberry Pi.</p>

<p>If you are using the Arduino IDE, you can go to the library manager (Sketch / Include Library / Manage Libraries&hellip;) and search for pH_Probe. Examples are included.</p>

<p>If you are using PlatformIO, you can install the library using the library manager (PlatformIO / PlatformIO Home / Libraries) and search for pH Probe. Examples are included.</p>

<p>For Raspberry Pi 3, you can clone the <a href="https://github.com/u-fire/ECSalinity-python">GitHub repo</a>. Before you can run anything, you will need to enable software I2C, as the Pi&rsquo;s hardware implementation has a clock-stretching bug that will prevent it from working with the pH probe.</p>

<ol>
<li><code class="prettyprint">sudo nano /boot/config.txt</code> and scroll to the bottom</li>
<li>Add <code class="prettyprint">dtoverlay=i2c-gpio,i2c_gpio_sda=&lt;pin&gt;,i2c_gpio_scl=&lt;pin&gt;</code>, replacing <code class="prettyprint">&lt;pin&gt;</code> with whatever pin you&rsquo;d like to use. Refer <a href="https://docs.microsoft.com/en-us/windows/iot-core/media/pinmappingsrpi/rp2_pinout.png">here</a> for the pin functions, you will need to use the orange GPIO xx labels in the picture to locate the pins. As an example, to use GPIO 17 as SDA and GPIO 27 as SCL, your line will look like this <code class="prettyprint">dtoverlay=i2c-gpio,i2c_gpio_sda=17,i2c_gpio_scl=27</code>
Alternatively, you can choose to use the existing I2C pins, but using a software implementation of I2C, by pasting <code class="prettyprint">dtoverlay=i2c-gpio</code>. If you go this route, you will need to edit line #4 from <code class="prettyprint">ph = phprobe(3)</code>, to <code class="prettyprint">ph = phprobe(1)</code>.</li>
<li><code class="prettyprint">ctrl + x</code> to exit, <code class="prettyprint">y</code> to save, and <code class="prettyprint">enter</code> to confirm the filename.</li>
<li>Reboot</li>
</ol>

<p>From inside repo folder, execute <code class="prettyprint">sudo python3 shell.ph</code> and you should be presented with a <code class="prettyprint">&gt;</code> prompt as described below.</p>

<h2 id="the-shell-example">The shell Example</h2>

<p>An interactive shell interface is provided with both frameworks and is a quick and easy way to get started using the device. You will find the equivalent commands in the code area to the right when applicable. Upload it to your master device and start a serial terminal. You will be presented with a <code class="prettyprint">&gt;</code> prompt where you can enter commands and receive a response, similar to a shell command line or REPL. It is often quicker to experiment with things this way rather than rewriting, compiling, and uploading new versions every time.</p>

<h2 id="changing-the-i2c-address">Changing the I2C Address</h2>

<p>If needed, the I2C address can be changed in programatically by calling <code class="prettyprint">setI2CAddress()</code>. The device will permanently change it&rsquo;s address to the passed value and continue to use it after a power reset. If you forget the new address, you will need to use an I2C bus scanner to locate it again.</p>

<h1 id="calibration">Calibration</h1>
<pre class="highlight cpp tab-cpp"><code><span class="cp">#include &lt;ECSalinity.h&gt;
</span><span class="n">EC_Salinity</span> <span class="n">ec</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">calibrationSolution_mS</span> <span class="o">=</span> <span class="mf">2.77</span><span class="p">;</span>

<span class="n">ec</span><span class="p">.</span><span class="n">setK</span><span class="p">(</span><span class="mf">10.0</span><span class="p">);</span>
<span class="n">ec</span><span class="p">.</span><span class="n">calibrateProbe</span><span class="p">(</span><span class="n">calibrationSolution_mS</span><span class="p">,</span> <span class="n">ec</span><span class="p">.</span><span class="n">tempCoefEC</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">ecsalinity</span> <span class="kn">import</span> <span class="n">ecsalinity</span>
<span class="n">ec</span> <span class="o">=</span> <span class="n">ecsalinity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">calibrationSolution_mS</span> <span class="o">=</span> <span class="mf">2.77</span>
<span class="n">ec</span><span class="o">.</span><span class="n">setK</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">ec</span><span class="o">.</span><span class="n">calibrateProbe</span><span class="p">(</span><span class="n">calibrationSolution_mS</span><span class="p">,</span> <span class="n">ec</span><span class="o">.</span><span class="n">tempCoefEC</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>k 10.0
cal 2.77
</code></pre>
<p>When the device is powered for the first time, it will be uncalibrated. There are two calibration options: single and dual or double point. Single point determines a percent difference between actual readings and expected readings, then uses it to make adjustments. Double point uses two points, a high and low, to determine the adjustment to make. The choice of single or double depends on the expected use. A small range might be better measured by single point calibration whereas a large range may be more accurate with double point.</p>

<p>Before any measurements can be made, to include measurements to calibrate the probe, the cell constant (K) must be specified. This number is typically 0.1, 1.0, or 10.0. The exact value may be found on the probe itself (9.988 for example). After K has been set, you can expect to see values being returned. It will not be accurate and must be calibrated.</p>

<p>For best results, the probe should be cleaned with distilled water and then placed in the solution for 5-10 minutes before the probe is used. It shouldn&rsquo;t be placed on the bottom or side of the solution container. Note that any turbidity, air bubbles, large particles, etc will effect readings. An unstable temperature will decrease accuracy as well.</p>

<p>When calibrating the probe, it is important to consider the expected temperature range. EC measurements are very temperature dependent, effecting the results by approximately 2% per degree C. The probe should be calibrated at the median expected temperature.</p>

<p>Likewise, the probe should be calibrated in the median expected EC range. For example, if you are planning to measure the salinity of an aquarium, you might expect readings ±5 from 35PPT (equivalent to 53mS). So a 53mS solution for calibration would be appropriate, whereas a hydroponic calibration might be 2.77mS or lower.</p>

<p>Another consideration is the placement of the probe. When the probe sends out a pulse of electricity, it leaves the probe in 360 degrees. If it is near a metal surface, you will experience fringing effects. The probe should be calibrated in an environment as similar as possible to the location it will be deployed in.</p>

<h3 id="single-point">Single Point</h3>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">solutionEC</span> <span class="o">=</span> <span class="mf">53.0</span><span class="p">;</span>
<span class="n">ec</span><span class="p">.</span><span class="n">calibrationProbe</span><span class="p">(</span><span class="n">solutionEC</span><span class="p">,</span> <span class="n">ec</span><span class="p">.</span><span class="n">tempCoefSalinity</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">solutionEC</span> <span class="o">=</span> <span class="mf">53.0</span>
<span class="n">ec</span><span class="o">.</span><span class="n">calibrationProbe</span><span class="p">(</span><span class="n">solutionEC</span><span class="p">,</span> <span class="n">ec</span><span class="o">.</span><span class="n">tempCoefSalinity</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>cal 53.0
</code></pre>
<p>For this method of calibrating, submerge the probe and wait for the readings to stabilize. Then call <code class="prettyprint">calibrateProbe()</code>. The calibration information will be stored in EEPROM and is the percent difference from the measured value and the expected value.</p>

<h3 id="dual-point">Dual Point</h3>

<p>Two calibration solutions are required, the low and high values you expect to measure between.</p>

<ol>
<li>Determine the lowest and highest measurement you expect. For example, the lowest level you might measure would be 50 mS and the highest might be 58 mS. These points will be referred to as
<code class="prettyprint">referenceLow</code> and <code class="prettyprint">referenceHigh</code></li>
<li>Put the EC probe in a calibration solution at <code class="prettyprint">referenceLow</code> and wait for readings to stabilize, call
<code class="prettyprint">calibrateProbeLow()</code>. Do the same for referenceHigh by calling &lsquo;calibrateProbeHigh&rsquo;.</li>
<li>By default, the device does not use dual points. A call to <code class="prettyprint">useDualPoint()</code> must be made to enable it each time the device is powered.</li>
</ol>

<p>You can also set all four values directly using <code class="prettyprint">setDualPointCalibration()</code>.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">solutionECLow</span> <span class="o">=</span> <span class="mf">53.0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">solutionECHigh</span> <span class="o">=</span> <span class="mf">58.0</span><span class="p">;</span>
<span class="n">ec</span><span class="p">.</span><span class="n">calibrateProbeLow</span><span class="p">(</span><span class="n">solutionECLow</span><span class="p">,</span> <span class="n">ec</span><span class="p">.</span><span class="n">tempCoefSalinity</span><span class="p">);</span>
<span class="n">ec</span><span class="p">.</span><span class="n">calibrateProbeHigh</span><span class="p">(</span><span class="n">solutionECHigh</span><span class="p">,</span> <span class="n">ec</span><span class="p">.</span><span class="n">tempCoefSalinity</span><span class="p">);</span>
<span class="n">ec</span><span class="p">.</span><span class="n">useDualPoint</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">solutionECLow</span> <span class="o">=</span> <span class="mf">53.0</span>
<span class="n">solutionECHigh</span> <span class="o">=</span> <span class="mf">58.0</span>
<span class="n">ec</span><span class="o">.</span><span class="n">calibrateProbeLow</span><span class="p">(</span><span class="n">solutionECLow</span><span class="p">,</span> <span class="n">ec</span><span class="o">.</span><span class="n">tempCoefSalinity</span><span class="p">)</span>
<span class="n">ec</span><span class="o">.</span><span class="n">calibrateProbeHigh</span><span class="p">(</span><span class="n">solutionECHigh</span><span class="p">,</span> <span class="n">ec</span><span class="o">.</span><span class="n">tempCoefSalinity</span><span class="p">)</span>
<span class="n">ec</span><span class="o">.</span><span class="n">useDualPoint</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>low 53.0
high 58.0
dp 1
</code></pre>
<p><code class="prettyprint">getCalibrateHigh</code> and <code class="prettyprint">getCalibrateLow</code> can be used
to get the currently set reference values.</p>

<p>Each call to <code class="prettyprint">measureEC</code> will use the calibration to adjust
the reading. It can be disabled by <code class="prettyprint">ec.useDualPoint(false);</code></p>

<h1 id="use">Use</h1>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">tempC</span> <span class="o">=</span> <span class="n">ec</span><span class="p">.</span><span class="n">measureTemp</span><span class="p">();</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">tempC</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">measureTemp</span><span class="p">()</span>
</code></pre><pre class="highlight shell tab-shell"><code>temp
</code></pre>
<p>Once the probe has been calibrated, a reading can be taken. The device will use
the most recent temperature measurement obtained from <code class="prettyprint">measureTemp</code> if temperature
compensation is enabled.The probe should be placed in the solution to be measured and <code class="prettyprint">measureEC</code>
called to start a measurement.</p>

<p>After the measurement is taken, the following class variables are updated:</p>

<ul>
<li><code class="prettyprint">uS</code></li>
<li><code class="prettyprint">mS</code></li>
<li><code class="prettyprint">S</code></li>
<li><code class="prettyprint">PPM_500</code></li>
<li><code class="prettyprint">PPM_640</code></li>
<li><code class="prettyprint">PPM_700</code></li>
<li><code class="prettyprint">salinityPSU</code></li>
<li><code class="prettyprint">salinityPPT</code></li>
<li><code class="prettyprint">salinityPPM</code></li>
<li><code class="prettyprint">tempC</code></li>
<li><code class="prettyprint">tempF</code></li>
</ul>

<h2 id="temperature-coefficients">Temperature Coefficients</h2>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">pureWaterCompensation</span> <span class="o">=</span> <span class="mf">0.0455</span><span class="p">;</span>
<span class="n">ec</span><span class="p">.</span><span class="n">measureEC</span><span class="p">(</span><span class="n">pureWaterCompensation</span><span class="p">);</span>
<span class="n">ec</span><span class="p">.</span><span class="n">measureEC</span><span class="p">();</span>
<span class="n">ec</span><span class="p">.</span><span class="n">measureSalinity</span><span class="p">();</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">pureWaterCompensation</span> <span class="o">=</span> <span class="mf">0.0455</span>
<span class="n">ec</span><span class="o">.</span><span class="n">measureEC</span><span class="p">(</span><span class="n">pureWaterCompensation</span><span class="p">)</span>
<span class="n">ec</span><span class="o">.</span><span class="n">measureEC</span><span class="p">()</span>
<span class="n">ec</span><span class="o">.</span><span class="n">measureSalinity</span><span class="p">()</span>
</code></pre><pre class="highlight shell tab-shell"><code>ec
sal
</code></pre>
<p>If the solution to be measured is saltwater, use <code class="prettyprint">measureSalinity()</code>,
if it is freshwater, use <code class="prettyprint">measureEC()</code>. A custom temperature
coefficient can be used by passing it to <code class="prettyprint">measureEC()</code>.</p>

<h2 id="temperature-compensation">Temperature Compensation</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">byte</span> <span class="n">tempConstant</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
<span class="n">ec</span><span class="p">.</span><span class="n">setTempConstant</span><span class="p">(</span><span class="n">tempConstant</span><span class="p">);</span>

<span class="n">ec</span><span class="p">.</span><span class="n">setTempConstant</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">tempConstant</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">ec</span><span class="o">.</span><span class="n">setTempConstant</span><span class="p">(</span><span class="n">tempConstant</span><span class="p">)</span>

<span class="n">ec</span><span class="o">.</span><span class="n">setTempConstant</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>tc 1 25
tc 0
tc 1 255
</code></pre>
<p>To set the temperature used for compensation, call
<code class="prettyprint">setTempConstant()</code> and pass the temperature to use. To use the
actual temperature, pass 0xFF.</p>

<h2 id="accuracy">Accuracy</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">ec</span><span class="p">.</span><span class="n">setAccuracy</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">setAccuracy</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>acc 21
</code></pre>
<p>The accuracy of the device can be adjusted by modifying <code class="prettyprint">setAccuracy</code>.
By default, 9 measurements are taken. A running median sort is applied and
the middle third of the nine measurements are averaged together to provide the
final result. Any number of measurements can be taken as long as it is evenly
divisible by 3. The least number of measures possible is 3.</p>

<h2 id="measurement-time">Measurement Time</h2>

<p>Each individual EC measurement takes 10ms. If the default accuracy is set to 9,
a call to <code class="prettyprint">measureEC</code> will return in about 90ms. A temperature measurement
takes 750ms.</p>

<h1 id="more-help">More Help</h1>

<p>If you have any questions, find a bug, or have any suggestions on improvements, go to this project&rsquo;s <a href="https://github.com/u-fire/ECSalinity">GitHub</a> page and submit an Issue or Pull Request.</p>

          <h1 id="class-members">Class Members</h1>

<h3 id="public-float-s"><code class="prettyprint">public float S</code></h3>

<p>EC in Siemens</p>

<h3 id="public-float-ms"><code class="prettyprint">public float mS</code></h3>

<p>EC in milli-Siemens</p>

<h3 id="public-float-us"><code class="prettyprint">public float uS</code></h3>

<p>EC in micro-Siemens</p>

<h3 id="public-long-ppm_500"><code class="prettyprint">public long PPM_500</code></h3>

<p>Parts per million using 500 as a multiplier</p>

<h3 id="public-long-ppm_640"><code class="prettyprint">public long PPM_640</code></h3>

<p>Parts per million using 640 as a multiplier</p>

<h3 id="public-long-ppm_700"><code class="prettyprint">public long PPM_700</code></h3>

<p>Parts per million using 700 as a multiplier</p>

<h3 id="public-float-salinitypsu"><code class="prettyprint">public float salinityPSU</code></h3>

<p>Salinity measured practical salinity units</p>

<h3 id="public-float-salinityppt"><code class="prettyprint">public float salinityPPT</code></h3>

<p>Salinity measured parts per thousand</p>

<h3 id="public-float-salinityppm"><code class="prettyprint">public float salinityPPM</code></h3>

<p>Salinity measured parts per million</p>

<h3 id="public-float-tempc"><code class="prettyprint">public float tempC</code></h3>

<p>Temperature in C</p>

<h3 id="public-float-tempf"><code class="prettyprint">public float tempF</code></h3>

<p>Temperature in F</p>

<h1 id="class-functions">Class Functions</h1>

<hr>

<h2 id="public-float-measureec-float-tempcoefficient"><code class="prettyprint">public float measureEC(float tempCoefficient)</code></h2>

<p>Starts an EC measurement.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">mS</span> <span class="o">=</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">measureEC</span><span class="p">(</span><span class="n">ec</span><span class="p">.</span><span class="n">tempCoefEC</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code>    <span class="n">ms</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">measureEC</span><span class="p">(</span><span class="n">ecsalinity</span><span class="o">.</span><span class="n">tempCoefEC</span><span class="p">)</span>
</code></pre>
<p>The device starst an EC measurement. The accuracy can be specified in EC_Salinity::setAccuracy.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">tempCoefficient</code> the coefficient used to compensate for temperature.</li>
</ul>

<p>uS, mS, S, tempC, tempF, PPM_500, PPM_640, PPM_700, salinityPPM, salinityPPT, and salinityPSU are updated</p>

<aside class="warning">
PPM is not valid if salinity is being measured, use salinityPPM or salinityPPT
</aside>

<h3 id="returns">Returns</h3>

<p>milli-Siemens</p>

<hr>

<h2 id="public-float-measureec"><code class="prettyprint">public float measureEC()</code></h2>

<p>Convenience function to measure EC in freshwater.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">mS</span> <span class="o">=</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">measureEC</span><span class="p">();</span>
</code></pre><pre class="highlight shell tab-shell"><code>ec
</code></pre>
<p>Calls EC_Salinity::measureEC(EC_Salinity::tempCoefEC)</p>

<aside class="note">
Not available in the python library.
</aside>

<h3 id="returns">Returns</h3>

<p>EC in mS</p>

<hr>

<h2 id="public-float-measuresalinity"><code class="prettyprint">public float measureSalinity()</code></h2>

<p>Convenience function to measure salinity.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">PSU</span> <span class="o">=</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">measureSalinity</span><span class="p">();</span>
</code></pre><pre class="highlight shell tab-shell"><code>sal
</code></pre>
<p>Calls EC_Salinity::measureEC(EC_Salinity::tempCoefSalinity)</p>

<h3 id="returns">Returns</h3>

<p>salinity in PSU</p>

<hr>

<h2 id="public-float-measuretemp"><code class="prettyprint">public float measureTemp()</code></h2>

<p>Starts a temperature measurement.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">tempC</span> <span class="o">=</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">measureTemp</span><span class="p">();</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">tempC</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">measureTemp</span><span class="p">()</span>
</code></pre><pre class="highlight shell tab-shell"><code>temp
</code></pre>
<p>tempC and tempF are updated</p>

<aside class="notice">
A value of -127 means the device is not connected.
</aside>

<h3 id="returns">Returns</h3>

<p>temperature in C</p>

<hr>

<h2 id="public-void-calibrateprobe-float-solutionec-float-tempcoef"><code class="prettyprint">public void calibrateProbe(float solutionEC,float tempCoef)</code></h2>

<p>Calibrates the connected probe and saves the result in EEPROM.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">calibrateProbe</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">tempCoefEC</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">calibrateProbe</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="n">ecsalinity</span><span class="o">.</span><span class="n">tempCoefEC</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>cal 2.77
</code></pre>
<h3 id="parameters">Parameters</h3>

<ul>
<li><p><code class="prettyprint">solutionEC</code> the EC of the calibration solution in mS</p></li>
<li><p><code class="prettyprint">tempCoef</code> the coefficient used to calibrate the probe</p></li>
</ul>

<p>offset will be saved in the device&rsquo;s EEPROM and used automatically thereafter</p>

<hr>

<h2 id="public-void-calibrateprobelow-float-solutionec-float-tempcoef"><code class="prettyprint">public void calibrateProbeLow(float solutionEC,float tempCoef)</code></h2>

<p>Calibrates the dual-point values for the low reading and saves them in the devices&rsquo;s EEPROM.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">calibrateProbeLow</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">tempCoefEC</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">calibrateProbeLow</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ecsalinity</span><span class="o">.</span><span class="n">tempCoefEC</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>low 1.0
</code></pre>
<h3 id="parameters">Parameters</h3>

<ul>
<li><p><code class="prettyprint">solutionEC</code> the EC of the calibration solution in mS</p></li>
<li><p><code class="prettyprint">tempCoef</code> the coefficient used to calibrate the probe</p></li>
</ul>

<hr>

<h2 id="public-void-calibrateprobehigh-float-solutionec-float-tempcoef"><code class="prettyprint">public void calibrateProbeHigh(float solutionEC,float tempCoef)</code></h2>

<p>Calibrates the dual-point values for the high reading and saves them in the devices&rsquo;s EEPROM.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">calibrateProbeHigh</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">tempCoefEC</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="p">:</span><span class="n">calibrateProbeHigh</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">ecsalinity</span><span class="o">.</span><span class="n">tempCoefEC</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>high 3.0
</code></pre>
<h3 id="parameters">Parameters</h3>

<ul>
<li><p><code class="prettyprint">solutionEC</code> the EC of the calibration solution in mS</p></li>
<li><p><code class="prettyprint">tempCoef</code> the coefficient used to calibrate the probe</p></li>
</ul>

<hr>

<h2 id="public-void-calculatek-float-solutionec-float-tempcoef"><code class="prettyprint">public void calculateK(float solutionEC,float tempCoef)</code></h2>

<p>Calculates the K value of the connected probe and saves it in EEPROM. Also essentially single-point calibrates the device.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">calculateK</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">tempCoefEC</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">calculateK</span><span class="p">(</span><span class="mf">2.77</span><span class="p">,</span> <span class="n">ecsalinity</span><span class="o">.</span><span class="n">tempCoefEC</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>calk 2.77
</code></pre>
<h3 id="parameters">Parameters</h3>

<ul>
<li><p><code class="prettyprint">solutionEC</code> the EC of the calibration solution in mS</p></li>
<li><p><code class="prettyprint">tempCoef</code> the coefficient used to calibrate the probe</p></li>
</ul>

<hr>

<h2 id="public-void-setdualpointcalibration-float-reflow-float-refhigh-float-readlow-float-readhigh"><code class="prettyprint">public void setDualPointCalibration(float refLow,float refHigh,float readLow,float readHigh)</code></h2>

<p>Sets all the values for dual point calibration and saves them in the devices&rsquo;s EEPROM.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">setDualPointCalibration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">setDualPointCalibration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">)</span>
</code></pre>
<h3 id="parameters">Parameters</h3>

<ul>
<li><p><code class="prettyprint">refLow</code> the reference low point</p></li>
<li><p><code class="prettyprint">refHigh</code> the reference high point</p></li>
<li><p><code class="prettyprint">readLow</code> the measured low point in mS</p></li>
<li><p><code class="prettyprint">readHigh</code> the measured high point in mS</p></li>
</ul>

<hr>

<h2 id="public-void-setk-float-k"><code class="prettyprint">public void setK(float k)</code></h2>

<p>Updates the device with a new cell constant and saves it in EEPROM.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">setK</span><span class="p">(</span><span class="mf">1.121</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">setK</span><span class="p">(</span><span class="mf">1.121</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>k 1.121
</code></pre>
<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">k</code> the new cell constant</li>
</ul>

<hr>

<h2 id="public-float-getk"><code class="prettyprint">public float getK()</code></h2>

<p>Retrieves the cell constant from the device.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">k</span> <span class="o">=</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">getK</span><span class="p">();</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">k</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">getK</span><span class="p">()</span>
</code></pre><pre class="highlight shell tab-shell"><code>k
</code></pre>
<h3 id="returns">Returns</h3>

<p>the cell constant</p>

<hr>

<h2 id="public-void-setaccuracy-byte-b"><code class="prettyprint">public void setAccuracy(byte b)</code></h2>

<p>Configures the accuracy of the device.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">setAccuracy</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">setAccuracy</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>acc 6
</code></pre>
<p>The device maintains a running median of values. It throws out the top and bottom third of values, then averages the middle third together to return a single value. The accuracy increases with a high number. It must be evenly divisible by 3.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">b</code> accuracy of the device</li>
</ul>

<hr>

<h2 id="public-byte-getaccuracy"><code class="prettyprint">public byte getAccuracy()</code></h2>
<pre class="highlight shell tab-shell"><code>acc
</code></pre>
<p>Retrieves the accuracy configuration of the device.</p>

<h3 id="returns">Returns</h3>

<p>accuracy</p>

<hr>

<h2 id="public-void-reset"><code class="prettyprint">public void reset()</code></h2>
<pre class="highlight shell tab-shell"><code>reset
</code></pre>
<p>Resets all the stored calibration information.</p>

<hr>

<h2 id="public-void-settempconstant-byte-b"><code class="prettyprint">public void setTempConstant(byte b)</code></h2>

<p>Configures device to use the provided temperature constant.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">setTempConstant</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
<span class="n">EC_Salinity</span><span class="o">::</span><span class="n">setTempConstant</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">);</span>   <span class="c1">// use the actual tempeature
</span></code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">setTempConstant</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ec</span><span class="o">.</span><span class="n">setTempConstant</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>tc 1 25
tc 0
tc 1 255
</code></pre>
<p>By default, the temperature constant is set to 0xFF which instructs the actual temperature to be used for temperature compensation, however any number can be specified. To use the actual temperature, restore the value to 0xFF.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">b</code> the temperature to use for compensation</li>
</ul>

<hr>

<h2 id="public-byte-gettempconstant"><code class="prettyprint">public byte getTempConstant()</code></h2>
<pre class="highlight shell tab-shell"><code>tc
</code></pre>
<p>Retrieves the temperature constant.</p>

<h3 id="returns">Returns</h3>

<p>the temperature to used for compensation</p>

<hr>

<h2 id="public-void-usetemperaturecompensation-bool-b"><code class="prettyprint">public void useTemperatureCompensation(bool b)</code></h2>

<p>Configures device to use temperature compensation or not.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">EC_Salinity</span><span class="o">::</span><span class="n">useTemperatureCompensation</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre><pre class="highlight python tab-python"><code><span class="n">ec</span><span class="o">.</span><span class="n">useTemperatureCompensation</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</code></pre><pre class="highlight shell tab-shell"><code>tc 1
</code></pre>
<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">b</code> true/false</li>
</ul>

<hr>

<h2 id="public-bool-usingtemperaturecompensation"><code class="prettyprint">public bool usingTemperatureCompensation()</code></h2>

<p>Determines if temperature compensation is being used.</p>

<h3 id="returns">Returns</h3>

<p>true if using compensation, false otherwise</p>

<hr>

<h2 id="public-void-usedualpoint-bool-b"><code class="prettyprint">public void useDualPoint(bool b)</code></h2>
<pre class="highlight shell tab-shell"><code>dp 1
</code></pre>
<p>Configures device to use dual-point calibration.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">b</code> true/false</li>
</ul>

<hr>

<h2 id="public-bool-usingdualpoint"><code class="prettyprint">public bool usingDualPoint()</code></h2>
<pre class="highlight shell tab-shell"><code>dp
</code></pre>
<p>Determines if dual point calibration is being used.</p>

<h3 id="returns">Returns</h3>

<p>true if using compensation, false otherwise</p>

<hr>

<h2 id="public-float-getcalibratehigh"><code class="prettyprint">public float getCalibrateHigh()</code></h2>
<pre class="highlight shell tab-shell"><code>high
</code></pre>
<p>Retrieves the dual-point calibration high value.</p>

<h3 id="returns">Returns</h3>

<p>the dual-point calibration high value</p>

<hr>

<h2 id="public-float-getcalibratelow"><code class="prettyprint">public float getCalibrateLow()</code></h2>
<pre class="highlight shell tab-shell"><code>low
</code></pre>
<p>Retrieves the dual-point calibration low value.</p>

<h3 id="returns">Returns</h3>

<p>the dual-point calibration low value</p>

<hr>

<h3 id="public-float-getcalibratehighreading"><code class="prettyprint">public float getCalibrateHighReading()</code></h3>

<p>Retrieves the dual-point calibration reading high value.</p>

<h3 id="returns">Returns</h3>

<p>the dual-point calibration high value</p>

<hr>

<h2 id="public-float-getcalibratelowreading"><code class="prettyprint">public float getCalibrateLowReading()</code></h2>

<p>Retrieves the dual-point calibration reading low value.</p>

<h3 id="returns">Returns</h3>

<p>the dual-point calibration low value</p>

<hr>

<h2 id="public-void-setcalibrateoffset-float-offset"><code class="prettyprint">public void setCalibrateOffset(float offset)</code></h2>

<p>Sets the single point offset value.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">offset</code> single point offset value</li>
</ul>

<hr>

<h2 id="public-float-getcalibrateoffset"><code class="prettyprint">public float getCalibrateOffset()</code></h2>
<pre class="highlight shell tab-shell"><code>cal
</code></pre>
<p>Retrieves the single point offset value.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">float</span> <span class="n">calibrateOffset</span> <span class="o">=</span> <span class="n">EC_Salinity</span><span class="o">::</span><span class="n">getCalibrateOffset</span><span class="p">();</span>
</code></pre>
<h3 id="returns">Returns</h3>

<p>single point offset value</p>

<hr>

<h2 id="public-byte-getversion"><code class="prettyprint">public byte getVersion()</code></h2>

<p>Retrieves the firmware version of the device.</p>

<h3 id="returns">Returns</h3>

<p>version of firmware</p>

<hr>

<h2 id="public-void-seti2caddress-uint8_t-address"><code class="prettyprint">public void setI2CAddress(uint8_t address)</code></h2>

<p>Changes the i2c address of the device. It will use the new address immediately
and continue to use it even after a power reset.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><code class="prettyprint">address</code> new i2c address</li>
</ul>

<aside class="note">
Not available in version 1
</aside>

<p>Generated by <a href="https://sourcey.com/moxygen">Moxygen</a></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="cpp">cpp</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>
</html>
