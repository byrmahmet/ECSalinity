<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.11"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>EC Salinity Class Implementation: Main Page</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">EC Salinity Class Implementation revision 1</a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">EC Salinity Class Implementation Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>The EC-Salinity I2C device can measure electrical conductivity in the range of 0.5 - 62mS and salinity from 2 - 42. </p><hr/>
<h1>Characteristics</h1>
<ul>
<li><b>EC range</b>: 0.5 - 62mS</li>
<li><b>Salinity range</b>: 2 - 42</li>
<li><b>Temperature range</b>: -2 - 35C</li>
<li><b>Interface</b>: I2C</li>
<li><b>Current use</b>: ~10mA peak, low idle current ~1mA</li>
<li><b>Voltage range</b>: 2.7 - 5.5V</li>
</ul>
<p>It uses the standard Arduino Wire library to interface with the device. It's operating principle is based on sending a very short-duration DC pulse from one probe pin and measuring the conductivity on the other pin. The conductivity is then converted to a temperature compensated Siemen. Salinity is also derived from the measure and is in PSU, PPT, and PPM. </p><hr/>
<h1>Connections</h1>
<p>Making the connections to the device is as follows: </p><table class="doxtable">
<tr>
<th align="center">EC Salinity Probe </th><th align="center">Master device  </th></tr>
<tr>
<td align="center">GND </td><td align="center">GND </td></tr>
<tr>
<td align="center">SCL </td><td align="center">SCL </td></tr>
<tr>
<td align="center">SDA </td><td align="center">SDA </td></tr>
<tr>
<td align="center">VCC </td><td align="center">2.7 - 5V </td></tr>
</table>
<p>The temperature probe should be connected as follows: </p><table class="doxtable">
<tr>
<th align="center">EC Salinity Probe </th><th align="center">Temperature Probe  </th></tr>
<tr>
<td align="center">+ </td><td align="center">VCC </td></tr>
<tr>
<td align="center">D </td><td align="center">Data </td></tr>
<tr>
<td align="center">- </td><td align="center">GND </td></tr>
</table>
<p>The EC probe has two pins and can be connected either way. </p><hr/>
<h1>Setup</h1>
<p>When the device is powered for the first time, it will be uncalibrated. The calibration setting of the probe is referred to as the cell constant (K). To begin the calibration process, place the thermometer and probe in a calibration solution then call the <a class="el" href="class_e_c___salinity.html#a33ffb6fb52b63b928ab45fb98c477826" title="Calibrates the connected probe and saves the result in EEPROM. ">EC_Salinity::calibrateProbe</a> function.</p>
<p>For best results, the probe should be cleaned with distilled water and then placed in the solution for 5-10 minutes before the probe is used. It shouldn't be placed on the bottom or side of the solution container. Note that any turbidity, air bubbles, large particles, etc will effect readings. An unstable temperature will decrease accuracy as well.</p>
<p>When calibrating the probe, it is important to consider the expected temperature range. EC measurements are very temperature dependent, effecting the results by approximately 2% per degree C. The probe should be calibrated at the median expected temperature.</p>
<p>Likewise, the probe should be calibrated in the median expected EC range. For example, if you are planning to measure the salinity of an aquarium, you might expect readings Â±5 from 35PPT (equivalent to 53mS). So a 53mS solution for calibration would be appropriate, whereas a hydroponic calibration might be 2.77mS.</p>
<p>Another consideration is the placement of the probe. When the probe sends out a pulse of electricity, it leaves the probe in 360 degrees. If it is near a metal surface, you will experience fringing effects. The probe should be calibrated in an environment as similar as possible to the location it will be deployed in.</p>
<p><a class="el" href="class_e_c___salinity.html#abfb9db695342135fe3c1d9e017099d01" title="Updates the device with a new cell constant and saves it in EEPROM. ">EC_Salinity::setK</a> can be used to set an arbitrary K value. <a class="el" href="class_e_c___salinity.html#a982b424d2ddc77d3b46bea505acf3bf5" title="Retrieves the cell constant from the device. ">EC_Salinity::getK</a> can be used to return the current K value.</p>
<h4>Dual Point Calibration</h4>
<p>Once the probe is calibrated, you can optionally use dual point calibration for more accurate results between two predesignated points. Two calibration solutions are required, the low and high values you expect to measure between.</p>
<ol type="1">
<li>Determine the lowest and highest measurement you expect in mS. For example, to measure salinity in an aquarium, the lowest level you would expect to measaure might be 30 PPT and the highest might be 38 PPT. These points are referred to as referenceLow and referenceHigh</li>
<li>Using the calibrated probe and a calibration solution at referenceLow, call <a class="el" href="class_e_c___salinity.html#ac5eb05c6d52dcba0bb2d4785a51659bc" title="Starts an EC measurement. ">EC_Salinity::measureEC</a> and see what the actual reading is. Do the same for referenceHigh. These readings are referred to as readingLow and readingHigh. As an example, the readingLow might be 27 and readingHigh might be 40.</li>
<li>Call <a class="el" href="class_e_c___salinity.html#af3cd5b404706edec78f1b117b8e9d6dd" title="Sets all the values for dual point calibration and saves them in the devices&#39;s EEPROM. ">EC_Salinity::setDualPointCalibration</a> to save the values to the device, then enable dual point calibration. By default, the device does not use dual point. A call to <a class="el" href="class_e_c___salinity.html#ad59943579cc4e237cbe48a2067b99e65" title="Configures device to use dual-point calibration. ">EC_Salinity::useDualPoint</a> must be made to enable it. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ec.setDualPointCalibration(30, 38, 27, 40);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;ec.useDualPoint(true);</div></div><!-- fragment --></li>
</ol>
<p><a class="el" href="class_e_c___salinity.html#a89cb728b13b422baa24729c386ae66b2" title="Calibrates the dual-point values for the low reading and saves them in the devices&#39;s EEPROM...">EC_Salinity::calibrateProbeLow</a> and <a class="el" href="class_e_c___salinity.html#a339b7cfaf85d56946aaa8b09e649eec0" title="Calibrates the dual-point values for the high reading and saves them in the devices&#39;s EEPROM...">EC_Salinity::calibrateProbeHigh</a> can be used to programatically determine the values.</p>
<p><a class="el" href="class_e_c___salinity.html#a77c403d82647d21a5540bc9e642e9627" title="Retrieves the dual-point calibration high value. ">EC_Salinity::getCalibrateHigh</a> and <a class="el" href="class_e_c___salinity.html#a793511d6d72e865d3a603cbfe2e89cc1" title="Retrieves the dual-point calibration low value. ">EC_Salinity::getCalibrateLow</a> can be used to get the currently set reference values.</p>
<ol type="1">
<li>Each call to <a class="el" href="class_e_c___salinity.html#ac5eb05c6d52dcba0bb2d4785a51659bc" title="Starts an EC measurement. ">EC_Salinity::measureEC</a> will use the provided numbers to adjust the reading. It can be disabled by <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ec.useDualPoint(false);</div></div><!-- fragment --> <hr/>
</li>
</ol>
<h1>Probe Selection</h1>
<p>A basic, but adequate, probe is included with the device. It will work reliably and accurately within the specifications listed above, however it is not specifically designed to be an EC probe. A professional probe can cost up to several hundred dollars. If you need the advantages of such an accurate device, this hobby-level project is not appropriate for you. However, most people don't need to measure EC to within 0.1uS reliably every time, in fact, a relatively wide range in accuracy will still be quite acceptable for many use-cases.</p>
<p>Any 2-electrode probe can be attached to the device. Keep in mind that metal, water, and electricity don't typically cooperate. Things that effect the lifespan include the chemicals it is exposed to, if it is occasionally exposed to air, the number of measurements taken, and the types of metal used. Deposit buildup will effect readings as well as chemical reactions that take place on the probe surface. It is very likely that it will require regular maintenance in the form of cleaning or recalibration. </p><hr/>
 <h1>Use</h1>
<p>Once the probe has been calibrated, a reading can be taken. The device will use the most recent temperature measurement obtained from <a class="el" href="class_e_c___salinity.html#ad0a0956675fc359950d1359927e248fd" title="Starts a temperature measurement. ">EC_Salinity::measureTemp</a>. If there is no temperature reading, a call to <a class="el" href="class_e_c___salinity.html#ad0a0956675fc359950d1359927e248fd" title="Starts a temperature measurement. ">EC_Salinity::measureTemp</a> will be made. The probe should be placed in the solution to be measured and <a class="el" href="class_e_c___salinity.html#ac5eb05c6d52dcba0bb2d4785a51659bc" title="Starts an EC measurement. ">EC_Salinity::measureEC</a> called to start a measurement. For best results, the probe should be cleaned with distilled water and left in the solution for 5 - 10 minutes. Be sure no air bubbles or debris are on the probe points.</p>
<p>After the measurement is taken, the following class variables are updated:</p>
<ul>
<li><a class="el" href="class_e_c___salinity.html#a7d5cf279e9c0cd10cc3ced6d30d8f4ad">EC_Salinity::uS</a></li>
<li><a class="el" href="class_e_c___salinity.html#ad835b40db253e61ad5898414eff3fc60">EC_Salinity::mS</a></li>
<li><a class="el" href="class_e_c___salinity.html#af3274d7a8037d1eee998d1dd3f50ce91">EC_Salinity::S</a></li>
<li><a class="el" href="class_e_c___salinity.html#a05a42f334f67a657136d033a0a1d69d6">EC_Salinity::PPM_500</a></li>
<li><a class="el" href="class_e_c___salinity.html#ae83ab780c294750919079477b871b2c9">EC_Salinity::PPM_640</a></li>
<li><a class="el" href="class_e_c___salinity.html#a95969d31584e0afc0128909dfd39b932">EC_Salinity::PPM_700</a></li>
<li><a class="el" href="class_e_c___salinity.html#a7e1c505419b7e8b2b9a4cb277701b6a3">EC_Salinity::salinityPSU</a></li>
<li><a class="el" href="class_e_c___salinity.html#a99faa627b03c807a535b956e98eec46e">EC_Salinity::salinityPPT</a></li>
<li><a class="el" href="class_e_c___salinity.html#a8b5bab63164f67830388f9065b40bc1d">EC_Salinity::salinityPPM</a></li>
<li><a class="el" href="class_e_c___salinity.html#a2733418c3eee1adaf51a5edd5aaf20fa">EC_Salinity::tempC</a></li>
<li><a class="el" href="class_e_c___salinity.html#a7abb032fef7156b3b99396ecf39cd731">EC_Salinity::tempF</a></li>
</ul>
<h4>Temperature Compensation</h4>
<p>If the solution to be measured is seawater, be sure to use the temperature compensation coefficient <a class="el" href="class_e_c___salinity.html#a6dece08b650de2f4eecf7822dbaee34b">EC_Salinity::tempCoefSalinity</a>, otherwise use <a class="el" href="class_e_c___salinity.html#aa5a1d7c5924a3c09be48911756b8c64a">EC_Salinity::tempCoefEC</a> as the parameter. If another compensation value is desired, it can be provided as a regular float value.</p>
<p>Readings can also be adjusted to a single temperature. In many modes of use, it is commonly adjusted to 25C. This can be done with the following:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ec.setTempConstant(25);</div></div><!-- fragment --><p> By default, it is set to 0xFF and the actual temperature is used. To re-enable compensation, set it back to 0xFF.</p>
<h4>Accuracy</h4>
<p>The accuracy of the device can be adjusted by modifying <a class="el" href="class_e_c___salinity.html#aaaaab96ad13c1f55772256f31d9de8de" title="Configures the accuracy of the device. ">EC_Salinity::setAccuracy</a>. By default, nine measurements are taken. A running median sort is applied and the middle third of the nine measurements are averaged together to provide the final result. Any number of measurements can be taken as long as it is evenly divisible by 3. The least number of measures possible is 3..</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ec.setAccuracy(15);</div></div><!-- fragment --><h4>Measurement Time</h4>
<p>Each individual EC measurement take 10ms. If the default accuracy is set to 9, a call to <a class="el" href="class_e_c___salinity.html#ac5eb05c6d52dcba0bb2d4785a51659bc" title="Starts an EC measurement. ">EC_Salinity::measureEC</a> will return in 90ms. A temperature measurement takes 750ms.</p>
<h4>Opearting without a DS18B20 Temperature Sensor</h4>
<p>The device can operate without a probe attached. If it detects that the probe is unattached, it does not modify the <a class="el" href="class_e_c___salinity.html#a2733418c3eee1adaf51a5edd5aaf20fa">EC_Salinity::tempC</a> value. You can optionally set </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ec.tempCompensationConstant = 25;</div></div><!-- fragment --><p> or you can specify your own value prior to calling <a class="el" href="class_e_c___salinity.html#ac5eb05c6d52dcba0bb2d4785a51659bc" title="Starts an EC measurement. ">EC_Salinity::measureEC</a>. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;ec.tempC = 22;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;ec.measureEC(ec.tempCoefEC);</div></div><!-- fragment --> <hr/>
<h1>Notes on Measuring Seawater</h1>
<p>Salinity can be accurately measured between a range of 2 - 42, between the -2 - 35 C. -1 is returned if it is not within the above limitations.</p>
<h1>References</h1>
<ul>
<li>Concept: <a href="https://www.element14.com/community/community/design-challenges/vertical-farming/blog/2015/09/13/automated-green-house-blogs-main-page">https://www.element14.com/community/community/design-challenges/vertical-farming/blog/2015/09/13/automated-green-house-blogs-main-page</a></li>
<li>Temperature coefficients: <a href="http://www.posiva.fi/files/2094/POSIVA-2001-15_Working-report_web.pdf">http://www.posiva.fi/files/2094/POSIVA-2001-15_Working-report_web.pdf</a></li>
<li>EC to PSU conversion: <a href="https://www.mwa.co.th/download/file_upload/SMWW_1000-3000.pdf">https://www.mwa.co.th/download/file_upload/SMWW_1000-3000.pdf</a> </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
